<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Helfer Dashboard - Unteriglinger Sch√ºtzenverein</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #1a1a1a;
      color: #e0e0e0;
    }

    .header {
      background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .header h1 {
      color: white;
      font-size: 1.5rem;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }

    .container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    .tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid #3a3a3a;
    }

    .tab {
      padding: 1rem 2rem;
      background: transparent;
      border: none;
      color: #999;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .tab.active {
      color: #4CAF50;
      border-bottom-color: #4CAF50;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 2rem;
    }

    .calendar-section {
      background: #2a2a2a;
      padding: 2rem;
      border-radius: 8px;
    }

    .chat-section {
      background: #2a2a2a;
      padding: 1.5rem;
      border-radius: 8px;
      height: fit-content;
      position: sticky;
      top: 2rem;
    }

    h2 {
      color: #4CAF50;
      margin-bottom: 1.5rem;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .calendar-nav {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .calendar-nav button {
      background: #1a472a;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
    }

    .month-year {
      font-size: 1.2rem;
      font-weight: bold;
      color: #4CAF50;
    }

    .person-cards {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .person-card {
      padding: 0.8rem 1.2rem;
      border-radius: 6px;
      cursor: move;
      font-weight: 600;
      user-select: none;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #1a1a1a;
      border: 1px solid #1a1a1a;
    }

    .calendar-day-header {
      background: #1a472a;
      color: white;
      padding: 0.8rem;
      text-align: center;
      font-weight: 600;
    }

    .calendar-day {
      background: #2a2a2a;
      min-height: 100px;
      padding: 0.5rem;
      position: relative;
    }

    .calendar-day.other-month {
      opacity: 0.3;
    }

    .calendar-day.drop-zone {
      background: rgba(76, 175, 80, 0.2);
    }

    .day-number {
      font-size: 0.9rem;
      color: #999;
      margin-bottom: 0.5rem;
    }

    .assigned-person {
      padding: 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
      margin-bottom: 0.3rem;
      position: relative;
    }

    .assigned-person.swapped {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .swap-info {
      font-size: 0.75rem;
      color: #ffa726;
      margin-top: 0.3rem;
    }

    .chat-messages {
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 1rem;
      padding: 1rem;
      background: #1a1a1a;
      border-radius: 6px;
    }

    .chat-message {
      background: #2a2a2a;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      border-left: 3px solid #4CAF50;
    }

    .swap-request {
      background: #3a3a2a;
      border-left-color: #ffa726;
    }

    .swap-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.8rem;
    }

    .btn-approve {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .btn-reject {
      background: #c62828;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .download-section {
      margin-bottom: 2rem;
    }

    .btn-download {
      background: #2d5a3d;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }

    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .chat-section {
        position: relative;
        top: 0;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üë• Helfer Dashboard</h1>
    <div class="header-actions">
      <button class="btn" id="logout-btn">Abmelden</button>
    </div>
  </div>

  <div class="container">
    <div class="tabs">
      <button class="tab active" onclick="showTab('wirte')">üç∫ Wirte</button>
      <button class="tab" onclick="showTab('aufsicht')">üéØ Schie√üaufsicht</button>
    </div>

    <!-- Wirte Tab -->
    <div id="wirte-tab" class="tab-content active">
      <div class="dashboard-grid">
        <div class="calendar-section">
          <div class="download-section">
            <h2>Wirteliste</h2>
            <a href="#" class="btn-download" id="download-wirte">üì• Wirteliste herunterladen</a>
          </div>

          <h2>Wirte-Kalender</h2>
          
          <div class="person-cards" id="wirte-cards">
            <!-- Wird dynamisch gef√ºllt -->
          </div>

          <div class="calendar-header">
            <div class="calendar-nav">
              <button onclick="previousMonth('wirte')">‚óÄ</button>
              <span class="month-year" id="wirte-month-year"></span>
              <button onclick="nextMonth('wirte')">‚ñ∂</button>
            </div>
          </div>

          <div class="calendar-grid" id="wirte-calendar">
            <!-- Wird dynamisch gef√ºllt -->
          </div>
        </div>

        <div class="chat-section">
          <h2>üí¨ Tausch-Anfragen</h2>
          <div class="chat-messages" id="wirte-chat">
            <p style="color: #999; text-align: center;">Keine Tausch-Anfragen</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Schie√üaufsicht Tab -->
    <div id="aufsicht-tab" class="tab-content">
      <div class="dashboard-grid">
        <div class="calendar-section">
          <div class="download-section">
            <h2>Schie√üaufsichtsliste</h2>
            <a href="#" class="btn-download" id="download-aufsicht">üì• Schie√üaufsichtsliste herunterladen</a>
          </div>

          <h2>Schie√üaufsicht-Kalender</h2>
          
          <div class="person-cards" id="aufsicht-cards">
            <!-- Wird dynamisch gef√ºllt -->
          </div>

          <div class="calendar-header">
            <div class="calendar-nav">
              <button onclick="previousMonth('aufsicht')">‚óÄ</button>
              <span class="month-year" id="aufsicht-month-year"></span>
              <button onclick="nextMonth('aufsicht')">‚ñ∂</button>
            </div>
          </div>

          <div class="calendar-grid" id="aufsicht-calendar">
            <!-- Wird dynamisch gef√ºllt -->
          </div>
        </div>

        <div class="chat-section">
          <h2>üí¨ Tausch-Anfragen</h2>
          <div class="chat-messages" id="aufsicht-chat">
            <p style="color: #999; text-align: center;">Keine Tausch-Anfragen</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, getDocs, addDoc, updateDoc, doc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyA6hD3scwCcytwkAoNhbNq6-lrYUcl8Fjk",
      authDomain: "schuetzenverein-12cfa.firebaseapp.com",
      projectId: "schuetzenverein-12cfa",
      storageBucket: "schuetzenverein-12cfa.firebasestorage.app",
      messagingSenderId: "791385091582",
      appId: "1:791385091582:web:b4c5aae9ddb155f10ee4af"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app, 'vorstandschaftschuetzen');

    // Check auth
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = 'helfer-login.html';
      }
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', async () => {
      await signOut(auth);
      window.location.href = 'index.html';
    });

    // Tab switching
    window.showTab = (tabName) => {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
    };

    // Sample data - In production, this would come from Firebase
    const wirtePersons = [
      { name: 'Max Mustermann', color: '#e57373' },
      { name: 'Anna Schmidt', color: '#64b5f6' },
      { name: 'Peter M√ºller', color: '#81c784' },
      { name: 'Lisa Weber', color: '#ffb74d' }
    ];

    const aufsichtPersons = [
      { name: 'Zink Alex', color: '#4CAF50' },
      { name: 'Zink Michi', color: '#2196F3' },
      { name: 'Thomas Klein', color: '#ff9800' },
      { name: 'Sarah Bauer', color: '#9c27b0' }
    ];

    let currentMonth = {
      wirte: new Date(),
      aufsicht: new Date()
    };

    // Initialize calendars
    function initCalendar(type) {
      renderPersonCards(type);
      renderCalendar(type);
    }

    function renderPersonCards(type) {
      const persons = type === 'wirte' ? wirtePersons : aufsichtPersons;
      const container = document.getElementById(`${type}-cards`);
      
      container.innerHTML = persons.map(person => `
        <div class="person-card" draggable="true" 
             style="background: ${person.color}; color: white;"
             data-person="${person.name}"
             data-color="${person.color}">
          ${person.name}
        </div>
      `).join('');

      // Add drag event listeners
      container.querySelectorAll('.person-card').forEach(card => {
        card.addEventListener('dragstart', handleDragStart);
      });
    }

    function renderCalendar(type) {
      const date = currentMonth[type];
      const year = date.getFullYear();
      const month = date.getMonth();
      
      // Update month/year display
      const monthNames = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni',
                         'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
      document.getElementById(`${type}-month-year`).textContent = 
        `${monthNames[month]} ${year}`;

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      const calendar = document.getElementById(`${type}-calendar`);
      calendar.innerHTML = '';

      // Day headers
      const dayHeaders = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
      dayHeaders.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        calendar.appendChild(header);
      });

      // Empty cells before first day
      const startDay = firstDay === 0 ? 6 : firstDay - 1;
      for (let i = 0; i < startDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day other-month';
        calendar.appendChild(emptyDay);
      }

      // Days of month
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-day';
        dayCell.innerHTML = `<div class="day-number">${day}</div>`;
        dayCell.dataset.date = `${year}-${month + 1}-${day}`;
        
        // Add drop event listeners
        dayCell.addEventListener('dragover', handleDragOver);
        dayCell.addEventListener('drop', handleDrop);
        dayCell.addEventListener('dragleave', handleDragLeave);
        
        calendar.appendChild(dayCell);
      }
    }

    let draggedPerson = null;

    function handleDragStart(e) {
      draggedPerson = {
        name: e.target.dataset.person,
        color: e.target.dataset.color
      };
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('drop-zone');
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('drop-zone');
    }

    function handleDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('drop-zone');
      
      if (draggedPerson) {
        const assignedDiv = document.createElement('div');
        assignedDiv.className = 'assigned-person';
        assignedDiv.style.background = draggedPerson.color;
        assignedDiv.style.color = 'white';
        assignedDiv.textContent = draggedPerson.name;
        
        e.currentTarget.appendChild(assignedDiv);
      }
    }

    window.previousMonth = (type) => {
      currentMonth[type].setMonth(currentMonth[type].getMonth() - 1);
      renderCalendar(type);
    };

    window.nextMonth = (type) => {
      currentMonth[type].setMonth(currentMonth[type].getMonth() + 1);
      renderCalendar(type);
    };

    // Initialize both calendars
    initCalendar('wirte');
    initCalendar('aufsicht');
  </script>
</body>
</html>
